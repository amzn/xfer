language: python
os: linux
python:
  - '3.4'
  - '3.5'
before_install: |
  if [[ $TRAVIS_OS_NAME == 'osx' ]]; then
    brew update
    # Recommended for pyenv
    brew outdated openssl || brew upgrade openssl
    brew outdated readline || brew upgrade readline
    # Update pyenv
    brew outdated pyenv || brew upgrade pyenv
    # Install specified Python version
    pyenv install $PYTHON
    # Set environment variables
    export PYENV_VERSION=$PYTHON
    export PATH="/Users/travis/.pyenv/shims:${PATH}"
    # Confirm versions
    python --version
    pip -V
    # Remove this line after GPy 1.9.3
    pip install numpy
  fi
install:
  - pip install --upgrade pip
  - pip install -r requirements.txt
  - pip install -r test_requirements.txt
  - pip freeze
script:
  - flake8
  - nosetests --with-coverage -v tests/unit/
  - nosetests --with-coverage -v tests/integration/
after_success:
  - codecov
jobs:
  include:
    - os: osx
      language: generic
      # Full version number required
      env: PYTHON=3.4.4
    - os: osx
      language: generic
      env: PYTHON=3.5.1
    - os: osx
      language: generic
      env: PYTHON=3.6.6
    - stage: release
      python: '3.6' # Official supported Python dist.
      deploy:
        provider: pypi
        server: https://test.pypi.org/legacy/ # Remove for deployment to official PyPi repo
        user: jmas
        password:
          secure:  dTE1XktLfnIWaQ1jnwNX0jtFf9qlkS2KekXQwqRB5x6zO3ou8FkOJIrp01WbDycDVyWAaIHGgZNj+sNlqhVnVKIgRj/fzIJ18Ur4GCmyhoJ9iB4GOPh9clBVBIkC6jSNAaQJlEzzHhx81RncKjhN2HaTpt7Xev89NrdBl0j1enyKPtYM7LrZGymlbdMBHpDTxbNe2CHkw+R+sgnBxtg1UttjMP36zuAQzNhqd5hT3fIuLyI3XWsNEL6/QL/oGN7IvBtm2a7cYsZvCiMDL3pgpKkirUOZGNgWjEGv+OipRavgal+As7J2WAGj0F2X4tVTBAzaf/hG8aQV3OXacMBrQJVUldpqsqpfnQB1gUxEOpk3/rcHMZUxG6uQbBFCrgfdFVUs6N/IDe6humkqiFpouXc+h5hhPcwvguOWJcdgHmlluEO/SnWaP41hDIwDw4zNv/EavG0ZI1645QXuSrLDOv1mgX4XEBvxprILzPhYhz3Za+Lw4v4UVIari3kE/ZQf5OYqhECj3Fou5/Rl65IOm0vOpp7JfVmJHni+EPVJbBRv4nQQ+GHl8CEFT1v+SejgUXfB3hMxOXYeEHPGbzCbgFqOnmLBPrxk/pPIwd4SLzGQf9GALkbJNASQQPjej3IBxhVHEhr+w9t8ffz0FtiLd28OoEa7IZayjmuLk2Q9WvM=
        on:
          branch: master
